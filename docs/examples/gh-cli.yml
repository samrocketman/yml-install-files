utility:
  gh:
    version: 2.75.0
    download: https://github.com/cli/cli/releases/download/v${version}/gh_${version}_${os}_${arch}.${extension}
    dest: ./scratch
    perm: '0755'
    checksum:
      macOS:
        arm64: 969c4c719738b365702de3e3b16fa144cc1757c703b5c7964c0b81b3b81265dc
        amd64: cee5c2dd0c4c421ae0d580ec1ec37a03f9fd84422ae7721d54ca54f767d920df
      linux:
        arm64: d116205efae3a409cbfbec173b0e8eff65e676e1ed3b573393eeca17301f9fb3
        amd64: 9c77b7d4d38be3f0e4c5656c6acfa916c8d24d7274d287447c5a12e468e44343
    os:
      Linux: linux
      Darwin: macOS
    arch:
      x86_64: amd64
      aarch64: arm64
    extension:
      default: tar.gz
      macOS: zip
    pre_command: |
      if [ "${checksum_failed:-true}" = true ]; then
        rm -f ${dest}/${utility}
      fi
    default_download_extract: |
      trap '[ ! -f /tmp/file.zip ] || rm -f /tmp/file.zip' EXIT
      curl -sSfL ${download} | ${extract}
    extract:
      macOS: |
        {
          cat > /tmp/file.zip
          unzip -o -j -d ${dest} /tmp/file.zip '*/bin/gh'
        }
      linux: tar -xzC ${dest}/ --no-same-owner --strip-components=2 gh_${version}_${os}_${arch}/bin/gh
    update: |
      export download=https://github.com/cli/cli/releases/latest
      eval "${default_download_head}" |
      awk '$1 ~ /[Ll]ocation:/ { gsub(".*/[^0-9.]*", "", $0); print;exit}'
