versions:
  clair: 4.8.0
  crane: 0.20.7
  cyclonedx: 0.29.1
  docker-buildx: 0.30.1
  docker-compose: 5.0.0
  dumb-init: 1.2.5
  gh: 2.83.1
  git-idm: 68c2ee1e406c2f2c72c8399e09564a970a025a0a
  gitleaks: 8.30.0
  goss: 0.4.9
  helm: 4.0.1
  jq: 1.8.1
  kind: 0.30.0
  kubeconform: 0.7.0
  kubectl: 1.34.2
  kubeval: 0.16.1
  kustomize: 5.8.0
  minikube: 1.37.0
  rvm-installer: 1.29.12
  saml2aws: 2.36.19
  yq: 4.49.2
checksums:
  clair:
    darwin: d237fdaedcce3a7c60c49ce21d2fc4b3f7cd2ed92f45364b2565340a1eca5f9b
    linux:
      arm64: 525581885fbca80e8dbc0d09849c128946443b12179ba47776657d41b9fb5721
      amd64: eec1311f5e68165b49c8b4d024c83fc46285bdca2f37e756becf21d534551434
  crane:
    Darwin:
      arm64: b0328c2c36d25415b0aac3b2cb24df8be8b19dfe787479a1db784e5063105f74
      x86_64: 2f01b1060df27beb9b443b28ae3f32dbe7cd91cfadf227605bd25b5417fd0ebf
    Linux:
      arm64: c35c622fdc915fbbfa004bb894803237ba3902c417114d9f168a6e40af1685ad
      x86_64: ffe4d4ec41f98975b4487164a94f02ea9c167269ea22aa5c4d8db45fd782a333
  cyclonedx:
    osx:
      arm64: d14e98223a2aff50b416eaebee0577566ff16e8b86a85cbb12c5a43b39f55f40
      x64: d38e495afdcb5b999b4e23dc61be0b06243fb253d8e849ec873ffabdb38d6013
    linux:
      arm64: f5e06b0ca05895feb39fb0d66443d6c64a50a7ac545e20a01b193b09adb1be9f
      x64: 1daceab1a7613603072db34d406659f0865623a4f137637440764cb9aa31236c
  docker-buildx:
    darwin:
      arm64: 48567264b45ee810e26fc805e5628a98ba27ddaf44506ea3c266544f68a30b2b
      amd64: 76c2369b8deb98ef96207075080f8eb8779567e4ba653310b732ab26a357b75a
    linux:
      arm64: 31d012d52d6df68aef4b55db62330967b562811f0de30cdfaa4505f314797c76
      amd64: c37114fcd034025ec68e224657c8a5a850df472ded3ddcbca75ad3a7ebb9710d
  docker-compose:
    darwin:
      aarch64: befac99c791df69b2703fccb7031e33197b5400d048d2ef11e209f85e0bd6638
      x86_64: 6d68486bede28047b2715f3ff9ecd57d38e459badc8a9eb6e004d0d0810c5d97
    linux:
      aarch64: d68ba7053066a44a51ee33b7dcdc106d8c8745eb0eaf46dc59fbbeb22ec46392
      x86_64: 5091bac5729ce968c602d157c2f0b959b7b367d4efb70aa864eb9ae78eebe13e
  dumb-init:
    linux:
      aarch64: b7d648f97154a99c539b63c55979cd29f005f88430fb383007fe3458340b795e
      x86_64: e874b55f3279ca41415d290c512a7ba9d08f98041b28ae7c2acb19a545f1c4df
  gh:
    macOS:
      arm64: 36a67e2862458ccb817544a8bfd22a399f370d5860b4ae4e7f9d99a980fb4375
      amd64: 454dbcb0db02b7010ca46fb3e7ec288ca5fbd6e9bd76b096dd622d5f2de64fdb
    linux:
      arm64: da2b6b67b52088c572ce22f3623352dd310f11ce1ebd8b5734d42ac195862c05
      amd64: b6706daf46c457166e03991ccbd79c3369ed762468b22cfd359adc5b819f5eca
  git-idm: d99592623838932190083cd1f2c8bc47af9f97e8fa4b6dab580c80830d4e2071
  gitleaks:
    darwin:
      arm64: 095bc4be1624239f52ebb90ff91668d1d3e78e0f8c5286e2d981887905c27561
      x64: f478677e8858ec3129153dec6e3f8dab5b5f674c120245e7878f89582444d06f
    linux:
      arm64: 3957ad3e168b6633307c1d8ea43bffa17557f825027504b13b574899212e635a
      x64: 8b6fd684fcd5b4ebe39b68abb072ce59e1063ce7ed4abd556157697845f1f088
  goss:
    darwin:
      arm64: 111d2ada89f8787838d176011de2fd0cfe8959c64c2698ce28feb587337d01fc
      amd64: e0c1b22360ced9f5394e64244877dfe1d3488aee9de75c56b9e02ae72c3fe4ff
    linux:
      arm64: 14fd24ac08236559f4809e6a627792d1b947ed98654bba1662ef1d6122d77e18
      amd64: 87dd36cfa1b8b50554e6e2ca29168272e26755b19ba5438341f7c66b36decc19
  helm:
    darwin:
      arm64: f3a1b9bc8b7e340358703a26771c2c1ccb462e516c4eae34951bab52c6b6c005
      amd64: b6a27619c41a3622c2a063a4e97ee75a5db501a15b1aed6483ae0cb34a3dadac
    linux:
      arm64: 0618a7dfa7cfde24089ba887044d4ac47103465aa7a4febf9aa4c5fdd4120f29
      amd64: 837c903cc14c5f936b353b9bdc99882ea2a36c7ed93f34e73e2ac5a0c4da51cd
  jq:
    macos:
      arm64: a9fe3ea2f86dfc72f6728417521ec9067b343277152b114f4e98d8cb0e263603
      amd64: e80dbe0d2a2597e3c11c404f03337b981d74b4a8504b70586c354b7697a7c27f
    linux:
      arm64: 6bc62f25981328edd3cfcfe6fe51b073f2d7e7710d7ef7fcdac28d4e384fc3d4
      amd64: 020468de7539ce70ef1bceaf7cde2e8c4f2ca6c3afb84642aabc5c97d9fc2a0d
  kind:
    darwin:
      arm64: 2628c53ddf4a2de19950df0452176e400e33b8c83834afab93651c2b6f9546bd
      amd64: 32bd46859a98bffdfc2e594850c4147d297b3f93007f8376b6d4a28e82dee29a
    linux:
      arm64: 1326f87d766e6108c4e140238b55a588721ea612c3ab2c242ed291da3d9f7608
      amd64: b543dca8440de4273be19ad818dcdfcf12ad1f767c962242fcccdb383dff893b
  kubeconform:
    darwin:
      arm64: 53de4b585d4a09fb8c9bbc5243d5a324bab6d94ee87e22733c430b9ef602b9ac
      amd64: 3ed36257c780891667bbaa21b15ab07ac0c8519b2423cd9f6ba2e7da4e3f15c3
    linux:
      arm64: c882bd5b5c30e81e59faf103018cbf85198f262ec5386e8bc50d3978e1e3dead
      amd64: dd5273bdbf08531bf230f4eba8359984b7beec25a679424ff90911a2591b8b0d
  kubectl:
    darwin:
      arm64: 8f38d3a38ae317b00ebf90254dc274dd28d8c6eea4a4b30c5cb12d3d27017b6d
      amd64: d2a71bb7dd7238287f2ba4efefbad4f98584170063f7d9e6c842f772d9255d45
    linux:
      arm64: 95df604e914941f3172a93fa8feeb1a1a50f4011dfbe0c01e01b660afc8f9b85
      amd64: 9591f3d75e1581f3f7392e6ad119aab2f28ae7d6c6e083dc5d22469667f27253
  kubeval:
    darwin: 5b667540e3093a80078262fd9e80a0653024262a049e6e47138f2f2d123df22f
    linux: 476e452f64f19fdb088ae1907973610bcc84263a0c6068918f8a8e461d18fe2b
  kustomize:
    darwin: 3a0f8dba2161500d57103b9fdbef49c248babcc77ac8554661678631f18c417d
    linux:
      arm64: 49c01a075160322a379eef2e1c0d84350ca8da55d0d124f4f10e55d305c98b95
      amd64: 69d1e2ddd0517166ad1ffb16496cae7b491979b879f78a5799c2d267c42156ab
  minikube:
    darwin:
      arm64: 5e0914c3559f6713295119477a6f5dc29862596effbfc764a61757bb314901d2
      amd64: 4c32b9e5fed64a311db9a40d6fdcc8fa794bc5bbc546545f4d187e9d416a74cb
    linux:
      arm64: 32f95860fffbbc825be38d05888542f10d3d580fe4d138f4aad71339b8038fb1
      amd64: d5cf561c71171152ff67d799f041ac0f65c235c87a1e9fc02a6a17b8226214d0
  rvm-installer: fea24461e98d41528d6e28684aa4c216dbe903869bc3fcdb3493b6518fae2e7e
  saml2aws:
    darwin:
      arm64: 2554c38ed8d0a92902943e6623ef16223e6e8536978c2bfc3301f7e6fc9b7eab
      amd64: ca04b5a67ea852315c9c66acd460cb0501d7fac9aa345e86f1179ccec7c6f0c7
    linux:
      arm64: 039477d1bdbff940e5de067e7a56ab48dcf5303869ff4b74da9d1a5a87d9ac7b
      amd64: ca8ec4da5566bef409c8c582da3cf9f22a8d5e18f7dcba25aeb9670f1ea98980
  yq:
    darwin:
      arm64: b0b70ede2b392ba02091b8137b42db819a7968cf232d595dd7394ac5668b4a0b
      amd64: c14cd4ae68d42074e58463f5ebdbc3c49ec27c6de6a23b4af58a483bc3f15aa0
    linux:
      arm64: 783aa3c3beedcf2bf4aaf6262eca38b92a16d3ea31e2218ca80ba8ec7226b248
      amd64: be2c0ddcf426b6a231648610ec5d1666ae50e9f6473e82f6486f9f4cb6e3e2f7


defaults: &defaults
  # dest could be /usr/local/bin in Docker builds
  dest: ./scratch
  perm: '0755'
  checksum_file: checksums/$(uname)-$(arch).sha256
  os:
    Linux: linux
    Darwin: darwin
  arch:
    x86_64: amd64
    aarch64: arm64
    Darwin:
      i386: amd64
  pre_command: |
    if [ "${checksum_failed:-true}" = true ]; then
      rm -f ${dest}/${utility}
    fi
  # Universal update; see git-idm utility where update is overridden
  update: |
    case "${download}" in
      https://github.com/*)
        owner="$(awk -F/ '{print $4"/"$5}' <<< "${download}")"
        export download=https://github.com/"${owner}"/releases/latest
        eval "${default_download_head}" |
        awk '$1 ~ /[Ll]ocation:/ { gsub(".*/[^0-9.]*", "", $0); print;exit}'
        ;;
      https://dl.k8s.io/release*)
        download=https://dl.k8s.io/release/stable.txt
        extract=cat
        export download extract
        eval "${default_download_extract}" |
        awk '{gsub("v", "", $0); print}'
        ;;
      https://get.helm.sh/*)
        export download=https://github.com/helm/helm/releases/latest
        eval "${default_download_head}" |
        awk '$1 ~ /[Ll]ocation:/ { gsub(".*/[^0-9.]*", "", $0); print;exit}'
        ;;
    esac
  # owner: someuser is also available
  # pre_command: shell scripting available
  # post_command: shell scripting available
utility:
  clair:
    <<: *defaults
    # not available on arm mac
    only: "[ ${os} = linux ] || [ ${arch} = amd64 ]"
    download: https://github.com/quay/clair/releases/download/v${version}/clairctl-${os}-${arch}
  crane:
    <<: *defaults
    # Darwin and Linux
    os:
    # x86_64 and arm64
    arch:
      aarch64: arm64
      Darwin:
        i386: x86_64
    download: https://github.com/google/go-containerregistry/releases/download/v${version}/go-containerregistry_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  cyclonedx:
    <<: *defaults
    os:
      Linux: linux
      Darwin: osx
    arch:
      x86_64: x64
      aarch64: arm64
      Darwin:
        i386: x64
    download: https://github.com/CycloneDX/cyclonedx-cli/releases/download/v${version}/cyclonedx-${os}-${arch}
  docker-buildx:
    <<: *defaults
    download: https://github.com/docker/buildx/releases/download/v${version}/buildx-v${version}.${os}-${arch}
  docker-compose:
    <<: *defaults
    # x86_64 and aarch64 are the two supported architectures.
    arch:
      arm64: aarch64
      Darwin:
        i386: x86_64
    download: https://github.com/docker/compose/releases/download/v${version}/docker-compose-${os}-${arch}
  dumb-init:
    <<: *defaults
    # force default architecture x86_64 and aarch64
    arch:
      Darwin:
        i386: x86_64
    only: "[ ${os} = linux ]"
    download: https://github.com/Yelp/dumb-init/releases/download/v${version}/dumb-init_${version}_${arch}
  gh:
    <<: *defaults
    os:
      Linux: linux
      Darwin: macOS
    extension:
      default: tar.gz
      macOS: zip
    default_download_extract: |
      trap '[ ! -f /tmp/file.zip ] || rm -f /tmp/file.zip' EXIT
      if type -P curl; then
        curl -sSfL ${download} | ${extract}
      else
        wget -q -O - ${download} | ${extract}
      fi
    extract:
      macOS: |
        {
          cat > /tmp/file.zip
          unzip -o -j -d ${dest} /tmp/file.zip '*/bin/gh'
        }
      linux: tar -xzC ${dest}/ --no-same-owner --strip-components=2 gh_${version}_${os}_${arch}/bin/gh
    download: https://github.com/cli/cli/releases/download/v${version}/gh_${version}_${os}_${arch}.${extension}
  git-idm:
    <<: *defaults
    download: https://raw.githubusercontent.com/samrocketman/git-identity-manager/${version}/git-idm
    update: >
      git ls-remote https://github.com/samrocketman/git-identity-manager.git |
      awk '$2 == "refs/heads/main" {print $1;exit}'
  gitleaks:
    <<: *defaults
    arch:
      x86_64: x64
      aarch64: arm64
      Darwin:
        i386: x64
    download: https://github.com/gitleaks/gitleaks/releases/download/v${version}/gitleaks_${version}_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  goss:
    <<: *defaults
    download: https://github.com/goss-org/goss/releases/download/v${version}/goss-${os}-${arch}
  helm:
    <<: *defaults
    download: https://get.helm.sh/helm-v${version}-${os}-${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner --strip-components=1 ${os}-${arch}/helm
  jq:
    <<: *defaults
    os:
      Linux: linux
      Darwin: macos
    download: https://github.com/jqlang/jq/releases/download/jq-${version}/jq-${os}-${arch}
  kind:
    <<: *defaults
    download: https://github.com/kubernetes-sigs/kind/releases/download/v0.19.0/kind-${os}-${arch}
  kubeconform:
    <<: *defaults
    download: https://github.com/yannh/kubeconform/releases/download/v${version}/kubeconform-${os}-${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  kubectl:
    <<: *defaults
    download: https://dl.k8s.io/release/v${version}/bin/${os}/${arch}/kubectl
  kubeval:
    <<: *defaults
    only: "[ ${arch} = amd64 ]"
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
    download: https://github.com/instrumenta/kubeval/releases/download/v${version}/kubeval-${os}-${arch}.tar.gz
  kustomize:
    <<: *defaults
    # https://github.com/kubernetes-sigs/kustomize/issues/5359
    only: "! ( [ ${os} = darwin ] && [ ${arch} = arm64 ]; )"
    download: https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2Fv${version}/kustomize_v${version}_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  minikube:
    <<: *defaults
    download: https://github.com/kubernetes/minikube/releases/download/v${version}/minikube-${os}-${arch}
  rvm-installer:
    <<: *defaults
    download: https://github.com/rvm/rvm/archive/refs/tags/${version}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner --strip-components=2 rvm-${version}/binscripts/${utility}
    post_command: |
      if [ "${checksum_failed:-true}" = false ]; then
        exit
      fi
      # can be swapped out with a GitHub release proxy
      # escape forward slashes
      base='github.com\/rvm\/rvm'
      sed -i.bak -e 's/\( *\)DEFAULT_SOURCES=(github.com.*/\1DEFAULT_SOURCES=('"${base}"')/' "${dest}/${utility}"
      rm "${dest}/${utility}".bak
      sed -i.bak -e 's/archive\//archive\/refs\/tags\//g' "${dest}/${utility}"
      rm "${dest}/${utility}".bak
      if [ -z "${skip_checksum:-}" ]; then
        exit 6
      fi
  saml2aws:
    <<: *defaults
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
    download: https://github.com/Versent/saml2aws/releases/download/v${version}/saml2aws_${version}_${os}_${arch}.tar.gz
  yq:
    <<: *defaults
    download: https://github.com/mikefarah/yq/releases/download/v${version}/yq_${os}_${arch}
