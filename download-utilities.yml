versions:
  clair: 4.7.4
  crane: 0.19.2
  cyclonedx: 0.25.1
  docker-buildx: 0.15.0
  docker-compose: 2.27.1
  dumb-init: 1.2.5
  gh: 2.51.0
  gimme: 1.5.5
  git-idm: a598aece805228fcc404af7597fd5cd9d98f6d44
  gitleaks: 8.18.4
  goss: 0.4.7
  helm: 3.15.2
  jq: 1.7.1
  kind: 0.23.0
  kubeconform: 0.6.6
  kubectl: 1.30.2
  kubeval: 0.16.1
  kustomize: 5.4.2
  minikube: 1.33.1
  rvm-installer: 1.29.12
  saml2aws: 2.36.16
  yq: 4.44.2
checksums:
  clair:
    darwin: d237fdaedcce3a7c60c49ce21d2fc4b3f7cd2ed92f45364b2565340a1eca5f9b
    linux:
      arm64: 6a320124ddbbeb6be9e54903db811af2d4e2b2816d8817058c78aba218f3f2e3
      amd64: 991e26b9eccddea647bb4ec19050da36bb7e91146f9b8bc362f40f511afac008
  crane:
    Darwin:
      arm64: 77d63d2e1311625d0dde47a12c925b53543375822a5a0292ecdf658b0273a5be
      x86_64: d6a37d03b02271e587cc9491331c7e2d5ab58f4d9042aa21714f171accc0b3e2
    Linux:
      arm64: 4ad82ecbe3ed8ce1a77ed4aec924594f79fb921c8cf5439ceeb6037a3fc461d5
      x86_64: d8fbee4a344fcc740b31fa522a329b0c12befd7f11e55502ff98f1d73331872b
  cyclonedx:
    osx:
      arm64: 77c1bb26bd45dc0c26d013ac6769c755f7154c69f23b520bf7b83df5aee99492
      x64: 4b47bd00b3526ed6049f04d3009abf5b103a8f24c002652022255444988bea39
    linux:
      arm64: 2086abf3182237d4349ae580ad27bd4f2f57bd0e8457cc92770cf35bd1c829df
      x64: f7f17434b6448d735f9fd91d6f72a1364c233f78a1587941cc26e9ecf33806e7
  docker-buildx:
    darwin:
      arm64: bc9fec41c007f603da3f1e6df358f63a477d12b178a98d3d3aa8ba1830c452cc
      amd64: b3a01c161d3b3ab963eae3ac415be1b5f4afbcbe1c8fd2d69efc160c9e8fb715
    linux:
      arm64: ad23578106a3a4f0a7bc9d8bdc9ba9155fa7b19889fba46f8f2c59fb10ab73fb
      amd64: 6569bb8b026b56d49a31aca80b61b4d0da1dbbf23ad6c925752790a9a350c9c5
  docker-compose:
    darwin:
      aarch64: 17feecc6038b7c95b64e3cd02bded53eec47f17cf4a54146ecaef70af3ca56c6
      x86_64: a6217853736f8936fedd3d20736e056b7416a8ef653f49d914504c3715855034
    linux:
      aarch64: 16e93b9c2fc147d29ca1acbb8ceab6a50a0e26af777f43dc7a753cb883142617
      x86_64: ddc876fe2a89d5b7ea455146b0975bfe52904eecba9b192193377d6f99d69ad9
  dumb-init:
    linux:
      aarch64: b7d648f97154a99c539b63c55979cd29f005f88430fb383007fe3458340b795e
      x86_64: e874b55f3279ca41415d290c512a7ba9d08f98041b28ae7c2acb19a545f1c4df
  gh:
    macOS:
      arm64: 2268e342757c9063a43e25e3df1d094175ea179bc3424a0c74bba20c1be1aaa9
      amd64: c485ca2b4d414617e8451df13a93586053b602f09162f991cf2850df7e457bfb
    linux:
      arm64: 8c0a0b369ca257bd0affda1223384a1c603cf7e3e5266ccb442de1d4410d244b
      amd64: c7e26ddb38be5773113e8b3a7fa439efe25f946e93035b193e362095cbcfd1d4
  gimme: 3d565d57ec28edb14be9e540cd3e628607ec5b791e78224c47250d36ce4aedf2
  git-idm: d99592623838932190083cd1f2c8bc47af9f97e8fa4b6dab580c80830d4e2071
  gitleaks:
    darwin:
      arm64: a86787a498e702f8820fc73c219ca44ecdf1f415eed8daf922888ffd6c4cf680
      x64: 3f83ea726b8f10c16dfa7ea08c73d1474ddbfe24db4a00e6764ec9abac05e19e
    linux:
      arm64: fc286fab02c3a0ba80670fc9f8cb1b495a2f62eb953d26113cfa3562f76b340b
      x64: 46a05260e7cce527f132cb618de59d22262b8b5eb47f66c288447b95c7a98b7e
  goss:
    darwin:
      arm64: 99055c24baf312af014e7f2ce69b2ae7e5775bb0205bc87e9c3f7c826e4a4f1c
      amd64: f3d319c0a0a76d5f6ce98595cadf82e073bc8b4cdca0a60ea5b6c24b5aad4758
    linux:
      arm64: b10311c95b4049b3d745315cf80e04ffa534aafb57077bbb2e9cd589a31f81cf
      amd64: 1206cc17af6d529baefae79c0cad6383c75f3cc68dc152632d393be827b13d5f
  helm:
    darwin:
      arm64: 8f802417820e6742914e9532b31b321bb7ef3a22100228959c780f5a734fd9c7
      amd64: 41645a5bfb474d015e9b003fae3674c59a608cfa9473c5e6df8b09a9b0df7b03
    linux:
      arm64: 5e5e3b098aa808055ab6703112269c5a3891d37aaa945bc423554503985d2e74
      amd64: 2dc819262ef5a362134322de223b9f39d42a2f2164b8ee62e3613a2a83b31e72
  jq:
    macos:
      arm64: 0bbe619e663e0de2c550be2fe0d240d076799d6f8a652b70fa04aea8a8362e8a
      amd64: 4155822bbf5ea90f5c79cf254665975eb4274d426d0709770c21774de5407443
    linux:
      arm64: 4dd2d8a0661df0b22f1bb9a1f9830f06b6f3b8f7d91211a1ef5d7c4f06a8b4a5
      amd64: 5942c9b0934e510ee61eb3e30273f1b3fe2590df93933a93d7c58b81d19c8ff5
  kind:
    darwin:
      arm64: 2628c53ddf4a2de19950df0452176e400e33b8c83834afab93651c2b6f9546bd
      amd64: 32bd46859a98bffdfc2e594850c4147d297b3f93007f8376b6d4a28e82dee29a
    linux:
      arm64: 1326f87d766e6108c4e140238b55a588721ea612c3ab2c242ed291da3d9f7608
      amd64: b543dca8440de4273be19ad818dcdfcf12ad1f767c962242fcccdb383dff893b
  kubeconform:
    darwin:
      arm64: 8e1a7784b2072a67a968023425d2100c465c2910dfe322cb8bb775096c3c2fe4
      amd64: 8436e4e1434ba5a94a314ad92ad0ea8a176e632479851b2e4d312226e991bdb0
    linux:
      arm64: 08e6798b7f0fe82c434a481f66344779a40204fdfe702ef3b5b932b9e8510b31
      amd64: f7caff462aa5f02aad6101fdf1c81d6b54f784b712dcfe289c1636e7827a75e8
  kubectl:
    darwin:
      arm64: ffcba19e77b9521f5779ab32cfcd4bfcc9d20cd42c2f075c7c5aef83f32754ae
      amd64: 0371b7bcc060f533170ac6fb99bc9aa13fdf3fa005276e3eb14eed162ed8a3a9
    linux:
      arm64: 56becf07105fbacd2b70f87f3f696cfbed226cb48d6d89ed7f65ba4acae3f2f8
      amd64: c6e9c45ce3f82c90663e3c30db3b27c167e8b19d83ed4048b61c1013f6a7c66e
  kubeval:
    darwin: 5b667540e3093a80078262fd9e80a0653024262a049e6e47138f2f2d123df22f
    linux: 476e452f64f19fdb088ae1907973610bcc84263a0c6068918f8a8e461d18fe2b
  kustomize:
    darwin: 3a0f8dba2161500d57103b9fdbef49c248babcc77ac8554661678631f18c417d
    linux:
      arm64: 859f12998e05490eb59aaebc60c7b637089f7b45775bfbde05f1e1b918605c3e
      amd64: 6bb59fec087d2d06e2bbf523ac48370665d5c565bdaeefe7ec3987a7f422ee4e
  minikube:
    darwin:
      arm64: 7e623ec9b5764681bd91b272d833dddec94527277c342bc458242389dc8a224a
      amd64: 6e1c3911c39b8de6b3ca31287f55b4f07ef329cd4b9ed62bf08378c2975580df
    linux:
      arm64: 0b6a17d230b4a605002981f1eba2f5aa3f2153361a1ab000c01e7a95830b40ba
      amd64: 386eb267e0b1c1f000f1b7924031557402fffc470432dc23b9081fc6962fd69b
  rvm-installer: fea24461e98d41528d6e28684aa4c216dbe903869bc3fcdb3493b6518fae2e7e
  saml2aws:
    darwin:
      arm64: cba61f9d06ef28b912708e2c8c8e44ff8aad698281a1bec4382a517815ead7f4
      amd64: 7b9ab384f05c7fa94585f85a2316c6cc35ed2606c7a9ac56b68b90855495e337
    linux:
      arm64: 0cc0ca1e4089ef31856f7ebde0e68c7d192cd6785e2dd59ca50572a585582886
      amd64: 316a9cfb7e0b2fedb549a440a0b981c3b92dbc978ccce07f15bf7771c3d9457c
  yq:
    darwin:
      arm64: 6cfa3c2c3a44356d0da42d8204fc85730cea999a779058d94d3a5b96d83f1030
      amd64: 6d3360c8c11cae7854069c832349acc50253d89b9d00b06700c7f99c8702d6ad
    linux:
      arm64: d05d9dae44503433e668d097143bfeb102ee7e2d486773ae23aaf81256ed54fd
      amd64: 246b781828353a59fb04ffaada241f78a8f3f25c623047b40306def1f6806e71


defaults: &defaults
  # dest could be /usr/local/bin in Docker builds
  dest: ./scratch
  perm: '0755'
  checksum_file: checksums/$(uname)-$(arch).sha256
  os:
    Linux: linux
    Darwin: darwin
  arch:
    x86_64: amd64
    aarch64: arm64
    Darwin:
      i386: amd64
  pre_command: |
    if [ "${checksum_failed:-true}" = true ]; then
      rm -f ${dest}/${utility}
    fi
  # Universal update; see git-idm utility where update is overridden
  update: |
    case "${download}" in
      https://github.com/*)
        owner="$(awk -F/ '{print $4"/"$5}' <<< "${download}")"
        export download=https://github.com/"${owner}"/releases/latest
        eval "${default_download_head}" |
        awk '$1 ~ /[Ll]ocation:/ { gsub(".*/[^0-9.]*", "", $0); print;exit}'
        ;;
      https://dl.k8s.io/release*)
        download=https://dl.k8s.io/release/stable.txt
        extract=cat
        export download extract
        eval "${default_download_extract}" |
        awk '{gsub("v", "", $0); print}'
        ;;
      https://get.helm.sh/*)
        export download=https://github.com/helm/helm/releases/latest
        eval "${default_download_head}" |
        awk '$1 ~ /[Ll]ocation:/ { gsub(".*/[^0-9.]*", "", $0); print;exit}'
        ;;
    esac
  # owner: someuser is also available
  # pre_command: shell scripting available
  # post_command: shell scripting available
utility:
  clair:
    <<: *defaults
    # not available on arm mac
    only: "[ ${os} = linux ] || [ ${arch} = amd64 ]"
    download: https://github.com/quay/clair/releases/download/v${version}/clairctl-${os}-${arch}
  crane:
    <<: *defaults
    # Darwin and Linux
    os:
    # x86_64 and arm64
    arch:
      aarch64: arm64
      Darwin:
        i386: x86_64
    download: https://github.com/google/go-containerregistry/releases/download/v${version}/go-containerregistry_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  cyclonedx:
    <<: *defaults
    os:
      Linux: linux
      Darwin: osx
    arch:
      x86_64: x64
      aarch64: arm64
      Darwin:
        i386: x64
    download: https://github.com/CycloneDX/cyclonedx-cli/releases/download/v${version}/cyclonedx-${os}-${arch}
  docker-buildx:
    <<: *defaults
    download: https://github.com/docker/buildx/releases/download/v${version}/buildx-v${version}.${os}-${arch}
  docker-compose:
    <<: *defaults
    # x86_64 and aarch64 are the two supported architectures.
    arch:
      arm64: aarch64
      Darwin:
        i386: x86_64
    download: https://github.com/docker/compose/releases/download/v${version}/docker-compose-${os}-${arch}
  dumb-init:
    <<: *defaults
    # force default architecture x86_64 and aarch64
    arch:
      Darwin:
        i386: x86_64
    only: "[ ${os} = linux ]"
    download: https://github.com/Yelp/dumb-init/releases/download/v${version}/dumb-init_${version}_${arch}
  gh:
    <<: *defaults
    os:
      Linux: linux
      Darwin: macOS
    extension:
      default: tar.gz
      macOS: zip
    default_download_extract: |
      trap '[ ! -f /tmp/file.zip ] || rm -f /tmp/file.zip' EXIT
      if type -P curl; then
        curl -sSfL ${download} | ${extract}
      else
        wget -q -O - ${download} | ${extract}
      fi
    extract:
      macOS: |
        {
          cat > /tmp/file.zip
          unzip -o -j -d ${dest} /tmp/file.zip '*/bin/gh'
        }
      linux: tar -xzC ${dest}/ --no-same-owner --strip-components=2 gh_${version}_${os}_${arch}/bin/gh
    download: https://github.com/cli/cli/releases/download/v${version}/gh_${version}_${os}_${arch}.${extension}
  gimme:
    <<: *defaults
    download: https://github.com/travis-ci/gimme/archive/refs/tags/v${version}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner --strip-components=1 gimme-${version}/${utility}
  git-idm:
    <<: *defaults
    download: https://raw.githubusercontent.com/samrocketman/git-identity-manager/${version}/git-idm
    update: >
      git ls-remote https://github.com/samrocketman/git-identity-manager.git |
      awk '$2 == "refs/heads/main" {print $1;exit}'
  gitleaks:
    <<: *defaults
    arch:
      x86_64: x64
      aarch64: arm64
      Darwin:
        i386: x64
    download: https://github.com/gitleaks/gitleaks/releases/download/v${version}/gitleaks_${version}_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  goss:
    <<: *defaults
    download: https://github.com/goss-org/goss/releases/download/v${version}/goss-${os}-${arch}
  helm:
    <<: *defaults
    download: https://get.helm.sh/helm-v${version}-${os}-${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner --strip-components=1 ${os}-${arch}/helm
  jq:
    <<: *defaults
    os:
      Linux: linux
      Darwin: macos
    download: https://github.com/jqlang/jq/releases/download/jq-${version}/jq-${os}-${arch}
  kind:
    <<: *defaults
    download: https://github.com/kubernetes-sigs/kind/releases/download/v0.19.0/kind-${os}-${arch}
  kubeconform:
    <<: *defaults
    download: https://github.com/yannh/kubeconform/releases/download/v${version}/kubeconform-${os}-${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  kubectl:
    <<: *defaults
    download: https://dl.k8s.io/release/v${version}/bin/${os}/${arch}/kubectl
  kubeval:
    <<: *defaults
    only: "[ ${arch} = amd64 ]"
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
    download: https://github.com/instrumenta/kubeval/releases/download/v${version}/kubeval-${os}-${arch}.tar.gz
  kustomize:
    <<: *defaults
    # https://github.com/kubernetes-sigs/kustomize/issues/5359
    only: "! ( [ ${os} = darwin ] && [ ${arch} = arm64 ]; )"
    download: https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2Fv${version}/kustomize_v${version}_${os}_${arch}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
  minikube:
    <<: *defaults
    download: https://github.com/kubernetes/minikube/releases/download/v${version}/minikube-${os}-${arch}
  rvm-installer:
    <<: *defaults
    download: https://github.com/rvm/rvm/archive/refs/tags/${version}.tar.gz
    extract: tar -xzC ${dest}/ --no-same-owner --strip-components=2 rvm-${version}/binscripts/${utility}
    post_command: |
      if [ "${checksum_failed:-true}" = false ]; then
        exit
      fi
      # can be swapped out with a GitHub release proxy
      # escape forward slashes
      base='github.com\/rvm\/rvm'
      sed -i.bak -e 's/\( *\)DEFAULT_SOURCES=(github.com.*/\1DEFAULT_SOURCES=('"${base}"')/' "${dest}/${utility}"
      rm "${dest}/${utility}".bak
      sed -i.bak -e 's/archive\//archive\/refs\/tags\//g' "${dest}/${utility}"
      rm "${dest}/${utility}".bak
      if [ -z "${skip_checksum:-}" ]; then
        exit 6
      fi
  saml2aws:
    <<: *defaults
    extract: tar -xzC ${dest}/ --no-same-owner ${utility}
    download: https://github.com/Versent/saml2aws/releases/download/v${version}/saml2aws_${version}_${os}_${arch}.tar.gz
  yq:
    <<: *defaults
    download: https://github.com/mikefarah/yq/releases/download/v${version}/yq_${os}_${arch}
